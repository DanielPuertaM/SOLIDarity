<form [formGroup]="donacionForm" (ngSubmit)="onSubmit()"><button (click)="goBack()" class="flex items-center gap-2 text-primary hover:underline mb-5 font-medium transition">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
    </svg>
    {{globalService.WORDS.LABEL.BACK}}
  </button>
  <div class="max-w-md mx-auto p-6 rounded-2xl shadow-lg bg-white dark:bg-base-200">
    
    <h2 class="text-xl font-semibold text-center mb-4">{{globalService.WORDS.LABEL.CHOOSE_AMOUNT}}</h2>

    <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-4">
      @for (monto of montosFijos; track monto) {
        <button
          type="button"
          class="btn w-full"
          [class.btn-primary]="donacionForm.value.monto === monto"
          [class.btn-outline]="donacionForm.value.monto !== monto"
          (click)="seleccionarMonto(monto)"
        >
          {{ 'COP ' + (monto | number: '1.0-0') }}
        </button>
      }
    </div>

    <div class="form-control mb-4">
      <label class="label text-sm font-medium">{{globalService.WORDS.LABEL.FREE_AMOUNT}}</label>
      <input
        type="number"
        formControlName="monto"
        class="input input-bordered w-full"
        placeholder="Otro monto"
      />
      @if (donacionForm.controls['monto'].invalid && donacionForm.controls['monto'].touched) {
        <p class="text-sm text-red-500 mt-1">
            {{globalService.WORDS.LABEL.AMOUNT_VALID_1000}}
        </p>
      }
    </div>

    <button
      type="submit"
      class="btn btn-primary w-full"
      [disabled]="donacionForm.invalid || loading()"
    >
      {{ loading() ? globalService.WORDS.LABEL.PROCESSING : globalService.WORDS.LABEL.DONATE_NOW }}
    </button>

@if (donacionResource.hasValue() && donacionResource.value()) {
  <div class="mt-6 rounded-2xl shadow-md bg-green-50 border border-green-200 dark:bg-green-900/20 dark:border-green-800 p-5 text-green-800 dark:text-green-100">
    <div class="flex items-center gap-2 mb-2">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-green-600 dark:text-green-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M5 13l4 4L19 7" />
      </svg>
      <h3 class="text-lg font-semibold"> {{globalService.WORDS.LABEL.THANKS_FOR_DONATION}}</h3>
    </div>

    <div class="text-sm space-y-1">
      <p><span class="font-medium text-gray-700 dark:text-gray-300">Monto:</span>
        {{ donacionResource.value().monto | number: '1.0-0' }} COP
      </p>
      <p><span class="font-medium text-gray-700 dark:text-gray-300">Fecha:</span>
        {{ donacionResource.value().fecha | date:'medium' }}
      </p>
      <p><span class="font-medium text-gray-700 dark:text-gray-300">ID de Donación:</span>
        #{{ donacionResource.value().id }}
      </p>
    </div>
  </div>
}

@if (donacionResource.error()) {
  <div class="mt-6 rounded-2xl shadow-md bg-red-50 border border-red-200 dark:bg-red-900/20 dark:border-red-800 p-5 text-red-800 dark:text-red-100">
    <div class="flex items-center gap-2 mb-2">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-red-600 dark:text-red-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M6 18L18 6M6 6l12 12" />
      </svg>
      <h3 class="text-lg font-semibold">{{globalService.WORDS.ERRORS.ERROR_PROCESSING_DONATION}}</h3>
    </div>

    <p class="text-sm">
      Ocurrió un problema al procesar tu donación.  
      Por favor, inténtalo de nuevo más tarde.
    </p>
  </div>
}

  </div>
</form>
